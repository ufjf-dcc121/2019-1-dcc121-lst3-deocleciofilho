<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> Torres de Ranoi</title>
    <link rel="stylesheet" href="estiloTorre.css">
</head>
<body>
<table id="msg">

    <tr>
        <td colspan="3" class=vtd></td>

    </tr>
    <tr>
    <td colspan="3" class=vtd></td>
    </tr>
</table>

<table>
    <tr>
        <td colspan="3">&#160;</td>
    </tr>
   
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/t1.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/t2.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/t3.gif"></a></td>
    </tr>
    
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif" ></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif" ></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif" ></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif" ></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif" ></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif" ></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td><a href="javascript:move('Um',1)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Dois',2)"><img src="imagensT/0.gif"></a></td>
        <td><a href="javascript:move('Três',3)"><img src="imagensT/0.gif"></a></td>
    </tr>
    <tr>
        <td colspan="3"><img src="imagensT/base.gif"></td>
    </tr>
    
</table>

<table>
    <tr>
    <td></td>
    <td><input type="button" id="reiniciar" value="Reiniciar" ></td>
    </tr>
</table>


<script>

    var movimento   = 0;
    var origem      = 1;
    var passo       = 0;
    var imgini      = 3;
    var torre = new arranjo();

    var msg = document.getElementById("msg").rows[0].cells;
    var msg2 = document.getElementById("msg").rows[1].cells;

    var btnReiniciar = document.getElementById("reiniciar");

    btnReiniciar.addEventListener("click", novojogo)

    novojogo();

    function novojogo() {
        for (var i = 0; i < 9; ++i) {
            if (i > 3)
                torre[1].piso[i] = i - 3;
            else 
                torre[1].piso[i] = 0;
                torre[2].piso[i] = 0;
                torre[3].piso[i] = 0;
        }
       
        msg[0].innerHTML =  "Selecione a torre origem.";
        movimento = 0;
        discos();

    }

    function discos() {
        for (var d = 1; d < 4; ++d)
            for (var i = 0; i < 9; ++i)
                document.images[(i * 3) + (d - 1) + 3].src = "imagensT/" + torre[d].piso[i] + ".gif";
        msg2[0].innerHTML =  movimento + " de 31 movimentos.";
        
    }

    function arranjo() {
        this[1] = new tipoDeTorre();
        this[2] = new tipoDeTorre();
        this[3] = new tipoDeTorre();
    }

    function tipoDeTorre() {
            this.piso = new tipopiso();
            for (var i = 0; i < 9; ++i)
                this.piso[i] = 0;

            this.acima = discoacima;
            this.remove = removedisco;
            this.coloca = colocadisco;
            this.fim = torrecompleta;
        }

    function tipopiso() {
        for (var i = 0; i <= 9; ++i)
            this[i] = 0;
    }
 
    function discoacima() {
        for (var i = 0; i < 9; ++i)
            if (this.piso[i] != 0)
                break;
        return this.piso[i];
    }

    function removedisco() {
        for (var i = 0; i < 9; ++i)
            if (this.piso[i] != 0) {
                this.piso[i] = 0;
                break;
            }
    }

    function colocadisco(disco) {
        for (var i = 0; i < 9; ++i)
            if (this.piso[i] != 0) {
                this.piso[i - 1] = disco;
                break;
            }
        if (this.piso[8] == 0)
            this.piso[8] = disco;
    }

    function torrecompleta() {
        for (var i = 3; i < 9; ++i)
            if (this.piso[i] != (i - 3))
                return false;
        return true;
    }

    function move(ntorre, numtorre) {
        if (passo == 0) {
            origem = numtorre;
            if (torre[origem].acima() != 0) {
               msg[0].innerHTML = "A torre origem é " + ntorre + ". Selecione a torre destino.";
                passo = 1;
            }
            else msg[0].innerHTML =  "Selecione a torre origem. ";
        }
        else if (passo == 1) {
            destino = numtorre;
            if ((torre[destino].acima() == 0) || (torre[origem].acima() < torre[destino].acima())) {
                torre[destino].coloca(torre[origem].acima());
                torre[origem].remove();
                movimento++;
                discos();
                if (torre[3].fim()) {
                   msg[0].innerHTML =  "Parabéns!!! Fim de Jogo. ";
                    if (movimento == 31)
                        msg2[0].innerHTML =   "Senssacional!!!";
                    else
                        mmsg2[0].innerHTML =   "Sobraram " + (movimento - 31) + " movimentos.";
                }
                else msg[0].innerHTML =  "Selecione a torre origem. ";
            }
            else msg[0].innerHTML =  "Selecione a torre origem. ";
            passo = 0;
        }
    }



</script>


</body>
</html>